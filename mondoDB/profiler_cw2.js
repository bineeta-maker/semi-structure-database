//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Group - 21
// Sanjay Ramesh : 210811700
// Ritika Gupta : 210487158
// Adity Ronak Shah: 210841431
// Bineeta Kachhap : 210619025
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Part2: b) Show the use of the MongoDB profiler for examining the performance of a selection of your MongoDB queries. 
// Illustrate the use of different values of the parameters to the MongoDB Profiler utility.
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


Profiler


// 1. The profilinglevel was set to 1 and the set of 12 queries were executed. the default parameter slowms: 100 and  sampleRate: 1
db.setProfilingLevel(1)


// 2. The query showed all the command pipeline being executed.
> db.system.profile.find({"command.pipeline": { $exists: true }},{"command.pipeline":1}).sort({$natural:-1})

{ "command" : { "pipeline" : [ { "$match" : { "lastWorkingDate" : { "$exists" : false } } }, { "$project" : { "_id" : 0, "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "number" : "$contactNumber", "address" : { "$concat" : [ { "$toString" : "$address.buildingNo" }, " ", "$address.street", ", ", "$address.city", "-", "$address.zipcode" ] } } } ] } }
{ "command" : { "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "departureCity" : "$departureCity", "arrivalCity" : "$arrivalCity" } }, { "$group" : { "_id" : { "year" : "$year", "month" : "$month", "dayOfMonth" : "$dayOfMonth" }, "flights" : { "$push" : { "$concat" : [ "$departureCity", " - ", "$arrivalCity" ] } } } } ] } }
{ "command" : { "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "employeeWorkSchedule" : 1 } }, { "$unwind" : "$employeeWorkSchedule" }, { "$group" : { "_id" : "$name", "salary" : { "$sum" : "$employeeWorkSchedule.salary" } } }, { "$sort" : { "salary" : -1 } }, { "$limit" : 5 } ] } }
{ "command" : { "pipeline" : [ { "$match" : { "address" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "address" : 1 } }, { "$group" : { "_id" : "$address.city", "employeeList" : { "$push" : "$name" } } } ] } }
{ "command" : { "pipeline" : [ { "$match" : { "joiningDate" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "joiningDate" : 1 } }, { "$sort" : { "joiningDate" : 1 } }, { "$limit" : 5 } ] } }
{ "command" : { "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 16 } } ] } }, { "$group" : { "_id" : { "date" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] } }, "flights" : { "$push" : "$flight" } } }, { "$unwind" : "$flights" }, { "$lookup" : { "from" : "bookings", "localField" : "flights", "foreignField" : "flight_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$group" : { "_id" : "$bookings.customer_id" } }, { "$lookup" : { "from" : "customers", "localField" : "_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "$_id", "customer" : { "$concat" : [ "$customers.title", " ", "$customers.firstName", " ", "$customers.lastName" ] } } } ] } }
{ "command" : { "pipeline" : [ { "$group" : { "_id" : "$bookingDate", "customerPayment" : { "$sum" : "$bookingAmount" } } }, { "$lookup" : { "from" : "employees", "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } } ], "as" : "employees" } }, { "$unwind" : "$employees" }, { "$group" : { "_id" : "$customerPayment", "totalSalary" : { "$sum" : { "$sum" : "$employees.employeeWorkSchedule.salary" } } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$totalSalary" ] } } }, { "$lookup" : { "from" : "planes", "pipeline" : [ { "$match" : { "state.status" : { "$in" : [ "in-repair", "upgraded" ] } } } ], "as" : "maintainanceCost" } }, { "$unwind" : "$maintainanceCost" }, { "$group" : { "_id" : "$profitEarned", "maintainanceCost" : { "$sum" : "$maintainanceCost.state.repairCost" } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$maintainanceCost" ] } } } ] } }
{ "command" : { "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id", "employee_list" : "$employee_list" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 17 } } ] } }, { "$unwind" : "$employee_list" }, { "$group" : { "_id" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] }, "employee" : { "$addToSet" : "$employee_list" } } }, { "$unwind" : "$employee" }, { "$lookup" : { "from" : "employees", "localField" : "employee", "foreignField" : "employee_id", "as" : "employees" } }, { "$unwind" : "$employees" }, { "$project" : { "_id" : "$_id", "Name" : { "$concat" : [ "$employees.firstName", " ", "$employees.lastName" ] }, "Number" : "$employees.contactNumber" } } ] } }
{ "command" : { "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : { "$cond" : { "if" : { "$isArray" : "$flight_id" }, "then" : { "$size" : "$flight_id" }, "else" : "NA" } } } }, { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : 1, "isMore" : { "$cond" : { "if" : { "$gt" : [ "$flightCount", 1 ] }, "then" : true, "else" : false } } } }, { "$group" : { "_id" : "$isMore", "customer_id" : { "$addToSet" : "$customer_id" } } }, { "$match" : { "_id" : true } }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Flights", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] } } } ] } }
{ "command" : { "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "bookingAmount" : 1 } }, { "$sort" : { "bookingAmount" : -1 } }, { "$limit" : 5 }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Top5", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] }, "address" : { "$concat" : [ { "$toString" : "$customers.address.buildingNo" }, " ", "$customers.address.street", ", ", "$customers.address.city", "-", "$customers.address.zipcode" ] } } } ] } }
{ "command" : { "pipeline" : [ { "$project" : { "name" : { "$concat" : [ "$title", " ", "$firstName", " ", "$lastName" ] }, "customer_id" : 1 } }, { "$lookup" : { "from" : "bookings", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$project" : { "name" : "$name", "customer_id" : 1, "flight" : "$bookings.flight_id", "price" : "$bookings.bookingAmount" } }, { "$unwind" : "$flight" }, { "$lookup" : { "from" : "flightSchedule", "localField" : "flight", "foreignField" : "flight_id", "as" : "schedule" } }, { "$unwind" : "$schedule" }, { "$project" : { "_id" : 0, "name" : 1, "price" : 1, "travel" : { "$concat" : [ "$schedule.departureCity", "-", "$schedule.arrivalCity" ] }, "travelTime" : { "$concat" : [ { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.departureTime" } }, " - ", { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.arrivalTime" } } ] } } } ] } }
{ "command" : { "pipeline" : [ { "$project" : { "name" : { "$concat" : [ "$title", " ", "$firstName", " ", "$lastName" ] }, "customer_id" : 1 } }, { "$lookup" : { "from" : "bookings", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$project" : { "name" : "$name", "customer_id" : 1, "flight" : "$bookings.flight_id", "price" : "$bookings.bookingAmount" } }, { "$unwind" : "$flight" }, { "$lookup" : { "from" : "flightSchedule", "localField" : "flight", "foreignField" : "flight_id", "as" : "schedule" } }, { "$unwind" : "$schedule" }, { "$project" : { "_id" : 0, "name" : 1, "price" : 1, "travel" : { "$concat" : [ "$schedule.departureCity", "-", "$schedule.arrivalCity" ] }, "travelTime" : { "$concat" : [ { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.departureTime" } }, " - ", { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.arrivalTime" } } ] } } } ] } }
{ "command" : { "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "bookingAmount" : 1 } }, { "$sort" : { "bookingAmount" : -1 } }, { "$limit" : 5 }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Top5", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] }, "address" : { "$concat" : [ { "$toString" : "$customers.address.buildingNo" }, " ", "$customers.address.street", ", ", "$customers.address.city", "-", "$customers.address.zipcode" ] } } } ] } }
{ "command" : { "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : { "$cond" : { "if" : { "$isArray" : "$flight_id" }, "then" : { "$size" : "$flight_id" }, "else" : "NA" } } } }, { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : 1, "isMore" : { "$cond" : { "if" : { "$gt" : [ "$flightCount", 1 ] }, "then" : true, "else" : false } } } }, { "$group" : { "_id" : "$isMore", "customer_id" : { "$addToSet" : "$customer_id" } } }, { "$match" : { "_id" : true } }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Flights", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] } } } ] } }
{ "command" : { "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id", "employee_list" : "$employee_list" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 17 } } ] } }, { "$unwind" : "$employee_list" }, { "$group" : { "_id" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] }, "employee" : { "$addToSet" : "$employee_list" } } }, { "$unwind" : "$employee" }, { "$lookup" : { "from" : "employees", "localField" : "employee", "foreignField" : "employee_id", "as" : "employees" } }, { "$unwind" : "$employees" }, { "$project" : { "_id" : "$_id", "Name" : { "$concat" : [ "$employees.firstName", " ", "$employees.lastName" ] }, "Number" : "$employees.contactNumber" } } ] } }
{ "command" : { "pipeline" : [ { "$group" : { "_id" : "$bookingDate", "customerPayment" : { "$sum" : "$bookingAmount" } } }, { "$lookup" : { "from" : "employees", "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } } ], "as" : "employees" } }, { "$unwind" : "$employees" }, { "$group" : { "_id" : "$customerPayment", "totalSalary" : { "$sum" : { "$sum" : "$employees.employeeWorkSchedule.salary" } } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$totalSalary" ] } } }, { "$lookup" : { "from" : "planes", "pipeline" : [ { "$match" : { "state.status" : { "$in" : [ "in-repair", "upgraded" ] } } } ], "as" : "maintainanceCost" } }, { "$unwind" : "$maintainanceCost" }, { "$group" : { "_id" : "$profitEarned", "maintainanceCost" : { "$sum" : "$maintainanceCost.state.repairCost" } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$maintainanceCost" ] } } } ] } }
{ "command" : { "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 16 } } ] } }, { "$group" : { "_id" : { "date" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] } }, "flights" : { "$push" : "$flight" } } }, { "$unwind" : "$flights" }, { "$lookup" : { "from" : "bookings", "localField" : "flights", "foreignField" : "flight_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$group" : { "_id" : "$bookings.customer_id" } }, { "$lookup" : { "from" : "customers", "localField" : "_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "$_id", "customer" : { "$concat" : [ "$customers.title", " ", "$customers.firstName", " ", "$customers.lastName" ] } } } ] } }
{ "command" : { "pipeline" : [ { "$match" : { "joiningDate" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "joiningDate" : 1 } }, { "$sort" : { "joiningDate" : 1 } }, { "$limit" : 5 } ] } }
{ "command" : { "pipeline" : [ { "$match" : { "address" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "address" : 1 } }, { "$group" : { "_id" : "$address.city", "employeeList" : { "$push" : "$name" } } } ] } }
{ "command" : { "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "employeeWorkSchedule" : 1 } }, { "$unwind" : "$employeeWorkSchedule" }, { "$group" : { "_id" : "$name", "salary" : { "$sum" : "$employeeWorkSchedule.salary" } } }, { "$sort" : { "salary" : -1 } }, { "$limit" : 5 } ] } }
Type "it" for more
>

// 3. The query showed all the command being executed with the plan summary COLLSCAN. As the profiling paramter were set to "slowms: 100" no data were capture that executed below 1 second.
> db.system.profile.find({"planSummary":{$eq:"COLLSCAN"},"op" : {$eq:"query"}}).sort({millis:-1})
{ "op" : "query", "ns" : "qmulairline.bookings", "command" : { "find" : "bookings", "filter" : { "$where" : "this.flight_id.length > 1" }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "cursorExhausted" : true, "numYield" : 1, "nreturned" : 8, "queryHash" : "864B2828", "planCacheKey" : "FA885FE8", "locks" : { "ReplicationStateTransition" : { "acquireCount" : { "w" : NumberLong(1) } }, "Global" : { "acquireCount" : { "r" : NumberLong(3) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "storage" : {  }, "responseLength" : 1543, "protocol" : "op_msg", "millis" : 105, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T10:00:16.267Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.bookings", "command" : { "find" : "bookings", "filter" : { "$where" : "this.flight_id.length > 1" }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 8, "queryHash" : "864B2828", "planCacheKey" : "FA885FE8", "locks" : { "ReplicationStateTransition" : { "acquireCount" : { "w" : NumberLong(1) } }, "Global" : { "acquireCount" : { "r" : NumberLong(4) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(3) } } }, "flowControl" : {  }, "readConcern" : { "provenance" : "implicitDefault" }, "storage" : {  }, "responseLength" : 1543, "protocol" : "op_msg", "millis" : 104, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "COLLSCAN", "filter" : { "$where" : { "code" : "this.flight_id.length > 1" } }, "nReturned" : 8, "executionTimeMillisEstimate" : 3, "works" : 25, "advanced" : 8, "needTime" : 16, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 23 }, "ts" : ISODate("2021-12-21T10:04:31.596Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.bookings", "command" : { "find" : "bookings", "filter" : { "$where" : "this.flight_id.length > 1" }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 8, "queryHash" : "864B2828", "planCacheKey" : "FA885FE8", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(3) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(3) } } }, "flowControl" : {  }, "readConcern" : { "provenance" : "implicitDefault" }, "responseLength" : 1543, "protocol" : "op_msg", "millis" : 67, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "COLLSCAN", "filter" : { "$where" : { "code" : "this.flight_id.length > 1" } }, "nReturned" : 8, "executionTimeMillisEstimate" : 1, "works" : 25, "advanced" : 8, "needTime" : 16, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 23 }, "ts" : ISODate("2021-12-21T11:40:10.235Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.bookings", "command" : { "find" : "bookings", "filter" : { "$where" : "this.flight_id.length > 1" }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 8, "queryHash" : "864B2828", "planCacheKey" : "FA885FE8", "locks" : { "ReplicationStateTransition" : { "acquireCount" : { "w" : NumberLong(1) } }, "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "storage" : {  }, "responseLength" : 1543, "protocol" : "op_msg", "millis" : 36, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "COLLSCAN", "filter" : { "$where" : { "code" : "this.flight_id.length > 1" } }, "nReturned" : 8, "executionTimeMillisEstimate" : 5, "works" : 25, "advanced" : 8, "needTime" : 16, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 23 }, "ts" : ISODate("2021-12-21T13:06:59.668Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
> db.system.profile.find({"planSummary":{$eq:"COLLSCAN"},"op" : {$eq:"query"}}).count()
4

// 4. The query showes top 10 slowest query.
> db.system.profile.find({"op" : {$eq:"command"}}, {"command.pipeline" : NumberInt(1),"millis": NumberInt(1)}).sort({millis:-1},{$limit:10})
{ "command" : { "pipeline" : [ { "$project" : { "name" : { "$concat" : [ "$title", " ", "$firstName", " ", "$lastName" ] }, "customer_id" : 1 } }, { "$lookup" : { "from" : "bookings", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$project" : { "name" : "$name", "customer_id" : 1, "flight" : "$bookings.flight_id", "price" : "$bookings.bookingAmount" } }, { "$unwind" : "$flight" }, { "$lookup" : { "from" : "flightSchedule", "localField" : "flight", "foreignField" : "flight_id", "as" : "schedule" } }, { "$unwind" : "$schedule" }, { "$project" : { "_id" : 0, "name" : 1, "price" : 1, "travel" : { "$concat" : [ "$schedule.departureCity", "-", "$schedule.arrivalCity" ] }, "travelTime" : { "$concat" : [ { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.departureTime" } }, " - ", { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.arrivalTime" } } ] } } } ] }, "millis" : 8 }
{ "command" : { "pipeline" : [ { "$project" : { "name" : { "$concat" : [ "$title", " ", "$firstName", " ", "$lastName" ] }, "customer_id" : 1 } }, { "$lookup" : { "from" : "bookings", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$project" : { "name" : "$name", "customer_id" : 1, "flight" : "$bookings.flight_id", "price" : "$bookings.bookingAmount" } }, { "$unwind" : "$flight" }, { "$lookup" : { "from" : "flightSchedule", "localField" : "flight", "foreignField" : "flight_id", "as" : "schedule" } }, { "$unwind" : "$schedule" }, { "$project" : { "_id" : 0, "name" : 1, "price" : 1, "travel" : { "$concat" : [ "$schedule.departureCity", "-", "$schedule.arrivalCity" ] }, "departureTime" : { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.departureTime" } }, "arrivalTime" : { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.arrivalTime" } } } } ] }, "millis" : 3 }
{ "command" : { "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 16 } } ] } }, { "$group" : { "_id" : { "date" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] } }, "flights" : { "$push" : "$flight" } } }, { "$unwind" : "$flights" }, { "$lookup" : { "from" : "bookings", "localField" : "flights", "foreignField" : "flight_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$group" : { "_id" : "$bookings.customer_id" } }, { "$lookup" : { "from" : "customers", "localField" : "_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "$_id", "customer" : { "$concat" : [ "$customers.title", " ", "$customers.firstName", " ", "$customers.lastName" ] } } } ] }, "millis" : 3 }
{ "command" : { "pipeline" : [ { "$project" : { "name" : { "$concat" : [ "$title", " ", "$firstName", " ", "$lastName" ] }, "customer_id" : 1 } }, { "$lookup" : { "from" : "bookings", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$project" : { "name" : "$name", "customer_id" : 1, "flight" : "$bookings.flight_id", "price" : "$bookings.bookingAmount" } }, { "$unwind" : "$flight" }, { "$lookup" : { "from" : "flightSchedule", "localField" : "flight", "foreignField" : "flight_id", "as" : "schedule" } }, { "$unwind" : "$schedule" }, { "$project" : { "_id" : 0, "name" : 1, "price" : 1, "travel" : { "$concat" : [ "$schedule.departureCity", "-", "$schedule.arrivalCity" ] }, "travelTime" : { "$concat" : [ { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.departureTime" } }, " - ", { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.arrivalTime" } } ] } } } ] }, "millis" : 3 }
{ "command" : { "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id", "employee_list" : "$employee_list" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 17 } } ] } }, { "$unwind" : "$employee_list" }, { "$group" : { "_id" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] }, "employee" : { "$addToSet" : "$employee_list" } } }, { "$unwind" : "$employee" }, { "$lookup" : { "from" : "employees", "localField" : "employee", "foreignField" : "employee_id", "as" : "employees" } }, { "$unwind" : "$employees" }, { "$project" : { "_id" : "$_id", "Name" : { "$concat" : [ "$employees.firstName", " ", "$employees.lastName" ] }, "Number" : "$employees.contactNumber" } } ] }, "millis" : 3 }
{ "command" : { "pipeline" : [ { "$match" : { "lastWorkingDate" : { "$exists" : false } } }, { "$project" : { "_id" : 0, "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "number" : "$contactNumber", "address" : { "$concat" : [ { "$toString" : "$address.buildingNo" }, " ", "$address.street", ", ", "$address.city", "-", "$address.zipcode" ] } } } ] }, "millis" : 2 }
{ "command" : { "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "departureCity" : "$departureCity", "arrivalCity" : "$arrivalCity" } }, { "$group" : { "_id" : { "year" : "$year", "month" : "$month", "dayOfMonth" : "$dayOfMonth" }, "flights" : { "$push" : { "$concat" : [ "$departureCity", " - ", "$arrivalCity" ] } } } } ] }, "millis" : 2 }
{ "command" : { "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id", "employee_list" : "$employee_list" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 17 } } ] } }, { "$unwind" : "$employee_list" }, { "$group" : { "_id" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] }, "employee" : { "$addToSet" : "$employee_list" } } }, { "$unwind" : "$employee" }, { "$lookup" : { "from" : "employees", "localField" : "employee", "foreignField" : "employee_id", "as" : "employees" } }, { "$unwind" : "$employees" }, { "$project" : { "_id" : "$_id", "Name" : { "$concat" : [ "$employees.firstName", " ", "$employees.lastName" ] }, "Number" : "$employees.contactNumber" } } ] }, "millis" : 2 }
{ "command" : { "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "bookingAmount" : 1 } }, { "$sort" : { "bookingAmount" : -1 } }, { "$limit" : 5 }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Top5", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] }, "address" : { "$concat" : [ { "$toString" : "$customers.address.buildingNo" }, " ", "$customers.address.street", ", ", "$customers.address.city", "-", "$customers.address.zipcode" ] } } } ] }, "millis" : 1 }
{ "command" : { "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "bookingAmount" : 1 } }, { "$sort" : { "bookingAmount" : -1 } }, { "$limit" : 5 }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Top5", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] }, "address" : { "$concat" : [ { "$toString" : "$customers.address.buildingNo" }, " ", "$customers.address.street", ", ", "$customers.address.city", "-", "$customers.address.zipcode" ] } } } ] }, "millis" : 1 }
{ "command" : { "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : { "$cond" : { "if" : { "$isArray" : "$flight_id" }, "then" : { "$size" : "$flight_id" }, "else" : "NA" } } } }, { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : 1, "isMore" : { "$cond" : { "if" : { "$gt" : [ "$flightCount", 1 ] }, "then" : true, "else" : false } } } }, { "$group" : { "_id" : "$isMore", "customer_id" : { "$addToSet" : "$customer_id" } } }, { "$match" : { "_id" : true } }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Flights", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] } } } ] }, "millis" : 1 }
{ "command" : { "pipeline" : [ { "$group" : { "_id" : "$bookingDate", "customerPayment" : { "$sum" : "$bookingAmount" } } }, { "$lookup" : { "from" : "employees", "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } } ], "as" : "employees" } }, { "$unwind" : "$employees" }, { "$group" : { "_id" : "$customerPayment", "totalSalary" : { "$sum" : { "$sum" : "$employees.employeeWorkSchedule.salary" } } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$totalSalary" ] } } }, { "$lookup" : { "from" : "planes", "pipeline" : [ { "$match" : { "state.status" : { "$in" : [ "in-repair", "upgraded" ] } } } ], "as" : "maintainanceCost" } }, { "$unwind" : "$maintainanceCost" }, { "$group" : { "_id" : "$profitEarned", "maintainanceCost" : { "$sum" : "$maintainanceCost.state.repairCost" } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$maintainanceCost" ] } } } ] }, "millis" : 1 }
{ "command" : { "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 16 } } ] } }, { "$group" : { "_id" : { "date" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] } }, "flights" : { "$push" : "$flight" } } }, { "$unwind" : "$flights" }, { "$lookup" : { "from" : "bookings", "localField" : "flights", "foreignField" : "flight_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$group" : { "_id" : "$bookings.customer_id" } }, { "$lookup" : { "from" : "customers", "localField" : "_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "$_id", "customer" : { "$concat" : [ "$customers.title", " ", "$customers.firstName", " ", "$customers.lastName" ] } } } ] }, "millis" : 1 }
{ "command" : { "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "departureCity" : "$departureCity", "arrivalCity" : "$arrivalCity" } }, { "$group" : { "_id" : { "year" : "$year", "month" : "$month", "dayOfMonth" : "$dayOfMonth" }, "flights" : { "$push" : { "$concat" : [ "$departureCity", " - ", "$arrivalCity" ] } } } } ] }, "millis" : 0 }
{ "command" : { "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "employeeWorkSchedule" : 1 } }, { "$unwind" : "$employeeWorkSchedule" }, { "$group" : { "_id" : "$name", "salary" : { "$sum" : "$employeeWorkSchedule.salary" } } }, { "$sort" : { "salary" : -1 } }, { "$limit" : 5 } ] }, "millis" : 0 }
{ "command" : { "pipeline" : [ { "$match" : { "address" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "address" : 1 } }, { "$group" : { "_id" : "$address.city", "employeeList" : { "$push" : "$name" } } } ] }, "millis" : 0 }
{ "command" : { "pipeline" : [ { "$match" : { "joiningDate" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "joiningDate" : 1 } }, { "$sort" : { "joiningDate" : 1 } }, { "$limit" : 5 } ] }, "millis" : 0 }
{ "command" : { "pipeline" : [ { "$group" : { "_id" : "$bookingDate", "customerPayment" : { "$sum" : "$bookingAmount" } } }, { "$lookup" : { "from" : "employees", "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } } ], "as" : "employees" } }, { "$unwind" : "$employees" }, { "$group" : { "_id" : "$customerPayment", "totalSalary" : { "$sum" : { "$sum" : "$employees.employeeWorkSchedule.salary" } } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$totalSalary" ] } } }, { "$lookup" : { "from" : "planes", "pipeline" : [ { "$match" : { "state.status" : { "$in" : [ "in-repair", "upgraded" ] } } } ], "as" : "maintainanceCost" } }, { "$unwind" : "$maintainanceCost" }, { "$group" : { "_id" : "$profitEarned", "maintainanceCost" : { "$sum" : "$maintainanceCost.state.repairCost" } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$maintainanceCost" ] } } } ] }, "millis" : 0 }
{ "command" : { "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : { "$cond" : { "if" : { "$isArray" : "$flight_id" }, "then" : { "$size" : "$flight_id" }, "else" : "NA" } } } }, { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : 1, "isMore" : { "$cond" : { "if" : { "$gt" : [ "$flightCount", 1 ] }, "then" : true, "else" : false } } } }, { "$group" : { "_id" : "$isMore", "customer_id" : { "$addToSet" : "$customer_id" } } }, { "$match" : { "_id" : true } }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Flights", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] } } } ] }, "millis" : 0 }
{ "command" : { "pipeline" : [ { "$match" : { "joiningDate" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "joiningDate" : 1 } }, { "$sort" : { "joiningDate" : 1 } }, { "$limit" : 5 } ] }, "millis" : 0 }
Type "it" for more
>


// 5. The profiling level was increatsed and the milliseconds were lowered to capture the result of all queries. 
db.setProfilingLevel(2, { slowms: 10, sampleRate: 1 })

// 6. After executing the 12 sets of query most of the execution status were captured. The query showed all the command pipeline being executed.
> db.system.profile.find()
{ "op" : "query", "ns" : "qmulairline.bookings", "command" : { "find" : "bookings", "filter" : { "$where" : "this.flight_id.length > 1" }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "cursorExhausted" : true, "numYield" : 1, "nreturned" : 8, "queryHash" : "864B2828", "planCacheKey" : "FA885FE8", "locks" : { "ReplicationStateTransition" : { "acquireCount" : { "w" : NumberLong(1) } }, "Global" : { "acquireCount" : { "r" : NumberLong(3) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "storage" : {  }, "responseLength" : 1543, "protocol" : "op_msg", "millis" : 105, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T10:00:16.267Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.bookings", "command" : { "find" : "bookings", "filter" : { "$where" : "this.flight_id.length > 1" }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 8, "queryHash" : "864B2828", "planCacheKey" : "FA885FE8", "locks" : { "ReplicationStateTransition" : { "acquireCount" : { "w" : NumberLong(1) } }, "Global" : { "acquireCount" : { "r" : NumberLong(4) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(3) } } }, "flowControl" : {  }, "readConcern" : { "provenance" : "implicitDefault" }, "storage" : {  }, "responseLength" : 1543, "protocol" : "op_msg", "millis" : 104, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "COLLSCAN", "filter" : { "$where" : { "code" : "this.flight_id.length > 1" } }, "nReturned" : 8, "executionTimeMillisEstimate" : 3, "works" : 25, "advanced" : 8, "needTime" : 16, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 23 }, "ts" : ISODate("2021-12-21T10:04:31.596Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.customers", "command" : { "aggregate" : "customers", "pipeline" : [ { "$project" : { "name" : { "$concat" : [ "$title", " ", "$firstName", " ", "$lastName" ] }, "customer_id" : 1 } }, { "$lookup" : { "from" : "bookings", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$project" : { "name" : "$name", "customer_id" : 1, "flight" : "$bookings.flight_id", "price" : "$bookings.bookingAmount" } }, { "$unwind" : "$flight" }, { "$lookup" : { "from" : "flightSchedule", "localField" : "flight", "foreignField" : "flight_id", "as" : "schedule" } }, { "$unwind" : "$schedule" }, { "$project" : { "_id" : 0, "name" : 1, "price" : 1, "travel" : { "$concat" : [ "$schedule.departureCity", "-", "$schedule.arrivalCity" ] }, "departureTime" : { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.departureTime" } }, "arrivalTime" : { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.arrivalTime" } } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 897, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 29, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(118) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(118) } } }, "flowControl" : {  }, "responseLength" : 4761, "protocol" : "op_msg", "millis" : 3, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T10:04:48.347Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "departureCity" : "$departureCity", "arrivalCity" : "$arrivalCity" } }, { "$group" : { "_id" : { "year" : "$year", "month" : "$month", "dayOfMonth" : "$dayOfMonth" }, "flights" : { "$push" : { "$concat" : [ "$departureCity", " - ", "$arrivalCity" ] } } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 10, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 2, "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 529, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T10:04:58.214Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.system.profile", "command" : { "find" : "system.profile", "filter" : { "planSummary" : { "$eq" : "COLLSCAN" }, "op" : { "$eq" : "query" } }, "sort" : { "millis" : -1 }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 4, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 2, "queryHash" : "69B24995", "planCacheKey" : "84F9E447", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 1807, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "SORT", "nReturned" : 2, "executionTimeMillisEstimate" : 0, "works" : 9, "advanced" : 2, "needTime" : 6, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "sortPattern" : { "millis" : -1 }, "memLimit" : 104857600, "type" : "simple", "totalDataSizeSorted" : 1750, "usedDisk" : false, "inputStage" : { "stage" : "COLLSCAN", "filter" : { "$and" : [ { "op" : { "$eq" : "query" } }, { "planSummary" : { "$eq" : "COLLSCAN" } } ] }, "nReturned" : 2, "executionTimeMillisEstimate" : 0, "works" : 6, "advanced" : 2, "needTime" : 3, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 4 } }, "ts" : ISODate("2021-12-21T10:05:06.549Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.system.profile", "command" : { "find" : "system.profile", "filter" : { "command.pipeline" : { "$exists" : true } }, "sort" : { "$natural" : -1 }, "projection" : { "command.pipeline" : 1 }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 5, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 2, "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 1537, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "PROJECTION_DEFAULT", "nReturned" : 2, "executionTimeMillisEstimate" : 0, "works" : 7, "advanced" : 2, "needTime" : 4, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "transformBy" : {  }, "inputStage" : { "stage" : "COLLSCAN", "filter" : { "command.pipeline" : { "$exists" : true } }, "nReturned" : 2, "executionTimeMillisEstimate" : 0, "works" : 7, "advanced" : 2, "needTime" : 4, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "backward", "docsExamined" : 5 } }, "ts" : ISODate("2021-12-21T11:38:26.460Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.system.profile", "command" : { "find" : "system.profile", "filter" : { "command.pipeline" : { "$exists" : true } }, "sort" : { "$natural" : -1 }, "projection" : { "command.pipeline" : 1 }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 6, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 2, "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 1537, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "PROJECTION_DEFAULT", "nReturned" : 2, "executionTimeMillisEstimate" : 0, "works" : 8, "advanced" : 2, "needTime" : 5, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "transformBy" : {  }, "inputStage" : { "stage" : "COLLSCAN", "filter" : { "command.pipeline" : { "$exists" : true } }, "nReturned" : 2, "executionTimeMillisEstimate" : 0, "works" : 8, "advanced" : 2, "needTime" : 5, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "backward", "docsExamined" : 6 } }, "ts" : ISODate("2021-12-21T11:38:35.428Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "lastWorkingDate" : { "$exists" : false } } }, { "$project" : { "_id" : 0, "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "number" : "$contactNumber", "address" : { "$concat" : [ { "$toString" : "$address.buildingNo" }, " ", "$address.street", ", ", "$address.city", "-", "$address.zipcode" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 16, "queryHash" : "B759E49D", "planCacheKey" : "57356B65", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 1622, "protocol" : "op_msg", "millis" : 2, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:05.123Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.bookings", "command" : { "find" : "bookings", "filter" : { "$where" : "this.flight_id.length > 1" }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 8, "queryHash" : "864B2828", "planCacheKey" : "FA885FE8", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(3) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(3) } } }, "flowControl" : {  }, "readConcern" : { "provenance" : "implicitDefault" }, "responseLength" : 1543, "protocol" : "op_msg", "millis" : 67, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "COLLSCAN", "filter" : { "$where" : { "code" : "this.flight_id.length > 1" } }, "nReturned" : 8, "executionTimeMillisEstimate" : 1, "works" : 25, "advanced" : 8, "needTime" : 16, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 23 }, "ts" : ISODate("2021-12-21T11:40:10.235Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "departureCity" : "$departureCity", "arrivalCity" : "$arrivalCity" } }, { "$group" : { "_id" : { "year" : "$year", "month" : "$month", "dayOfMonth" : "$dayOfMonth" }, "flights" : { "$push" : { "$concat" : [ "$departureCity", " - ", "$arrivalCity" ] } } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 10, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 2, "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 529, "protocol" : "op_msg", "millis" : 2, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:16.085Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "employeeWorkSchedule" : 1 } }, { "$unwind" : "$employeeWorkSchedule" }, { "$group" : { "_id" : "$name", "salary" : { "$sum" : "$employeeWorkSchedule.salary" } } }, { "$sort" : { "salary" : -1 } }, { "$limit" : 5 } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 5, "queryHash" : "3B6B892B", "planCacheKey" : "5EBAD363", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 345, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:27.316Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "address" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "address" : 1 } }, { "$group" : { "_id" : "$address.city", "employeeList" : { "$push" : "$name" } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 4, "queryHash" : "57ECD407", "planCacheKey" : "3FCB7D05", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 742, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:33.725Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "joiningDate" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "joiningDate" : 1 } }, { "$sort" : { "joiningDate" : 1 } }, { "$limit" : 5 } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 5, "queryHash" : "20758362", "planCacheKey" : "1F03DCD3", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 469, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:39.386Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 16 } } ] } }, { "$group" : { "_id" : { "date" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] } }, "flights" : { "$push" : "$flight" } } }, { "$unwind" : "$flights" }, { "$lookup" : { "from" : "bookings", "localField" : "flights", "foreignField" : "flight_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$group" : { "_id" : "$bookings.customer_id" } }, { "$lookup" : { "from" : "customers", "localField" : "_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "$_id", "customer" : { "$concat" : [ "$customers.title", " ", "$customers.firstName", " ", "$customers.lastName" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 400, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 12, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(36) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(36) } } }, "flowControl" : {  }, "responseLength" : 817, "protocol" : "op_msg", "millis" : 3, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:45.970Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.bookings", "command" : { "aggregate" : "bookings", "pipeline" : [ { "$group" : { "_id" : "$bookingDate", "customerPayment" : { "$sum" : "$bookingAmount" } } }, { "$lookup" : { "from" : "employees", "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } } ], "as" : "employees" } }, { "$unwind" : "$employees" }, { "$group" : { "_id" : "$customerPayment", "totalSalary" : { "$sum" : { "$sum" : "$employees.employeeWorkSchedule.salary" } } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$totalSalary" ] } } }, { "$lookup" : { "from" : "planes", "pipeline" : [ { "$match" : { "state.status" : { "$in" : [ "in-repair", "upgraded" ] } } } ], "as" : "maintainanceCost" } }, { "$unwind" : "$maintainanceCost" }, { "$group" : { "_id" : "$profitEarned", "maintainanceCost" : { "$sum" : "$maintainanceCost.state.repairCost" } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$maintainanceCost" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 48, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 1, "queryHash" : "685D33D1", "planCacheKey" : "FC552456", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(6) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(6) } } }, "flowControl" : {  }, "responseLength" : 155, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:52.079Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id", "employee_list" : "$employee_list" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 17 } } ] } }, { "$unwind" : "$employee_list" }, { "$group" : { "_id" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] }, "employee" : { "$addToSet" : "$employee_list" } } }, { "$unwind" : "$employee" }, { "$lookup" : { "from" : "employees", "localField" : "employee", "foreignField" : "employee_id", "as" : "employees" } }, { "$unwind" : "$employees" }, { "$project" : { "_id" : "$_id", "Name" : { "$concat" : [ "$employees.firstName", " ", "$employees.lastName" ] }, "Number" : "$employees.contactNumber" } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 241, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 12, "queryHash" : "5361BE73", "planCacheKey" : "59FBB228", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(26) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(26) } } }, "flowControl" : {  }, "responseLength" : 935, "protocol" : "op_msg", "millis" : 2, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:57.483Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.bookings", "command" : { "aggregate" : "bookings", "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : { "$cond" : { "if" : { "$isArray" : "$flight_id" }, "then" : { "$size" : "$flight_id" }, "else" : "NA" } } } }, { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : 1, "isMore" : { "$cond" : { "if" : { "$gt" : [ "$flightCount", 1 ] }, "then" : true, "else" : false } } } }, { "$group" : { "_id" : "$isMore", "customer_id" : { "$addToSet" : "$customer_id" } } }, { "$match" : { "_id" : true } }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Flights", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 8, "queryHash" : "08A9F031", "planCacheKey" : "59FC5123", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(4) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(4) } } }, "flowControl" : {  }, "responseLength" : 552, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:41:04.036Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.bookings", "command" : { "aggregate" : "bookings", "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "bookingAmount" : 1 } }, { "$sort" : { "bookingAmount" : -1 } }, { "$limit" : 5 }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Top5", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] }, "address" : { "$concat" : [ { "$toString" : "$customers.address.buildingNo" }, " ", "$customers.address.street", ", ", "$customers.address.city", "-", "$customers.address.zipcode" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 123, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 5, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(12) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(12) } } }, "flowControl" : {  }, "responseLength" : 615, "protocol" : "op_msg", "millis" : 1, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:41:09.405Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.customers", "command" : { "aggregate" : "customers", "pipeline" : [ { "$project" : { "name" : { "$concat" : [ "$title", " ", "$firstName", " ", "$lastName" ] }, "customer_id" : 1 } }, { "$lookup" : { "from" : "bookings", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$project" : { "name" : "$name", "customer_id" : 1, "flight" : "$bookings.flight_id", "price" : "$bookings.bookingAmount" } }, { "$unwind" : "$flight" }, { "$lookup" : { "from" : "flightSchedule", "localField" : "flight", "foreignField" : "flight_id", "as" : "schedule" } }, { "$unwind" : "$schedule" }, { "$project" : { "_id" : 0, "name" : 1, "price" : 1, "travel" : { "$concat" : [ "$schedule.departureCity", "-", "$schedule.arrivalCity" ] }, "travelTime" : { "$concat" : [ { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.departureTime" } }, " - ", { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.arrivalTime" } } ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 897, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 29, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(118) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(118) } } }, "flowControl" : {  }, "responseLength" : 4239, "protocol" : "op_msg", "millis" : 3, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:41:15.262Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.system.profile", "command" : { "find" : "system.profile", "filter" : { "command.pipeline" : { "$exists" : true } }, "sort" : { "$natural" : -1 }, "projection" : { "command.pipeline" : 1 }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 19, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 13, "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 8737, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "PROJECTION_DEFAULT", "nReturned" : 13, "executionTimeMillisEstimate" : 0, "works" : 21, "advanced" : 13, "needTime" : 7, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "transformBy" : {  }, "inputStage" : { "stage" : "COLLSCAN", "filter" : { "command.pipeline" : { "$exists" : true } }, "nReturned" : 13, "executionTimeMillisEstimate" : 0, "works" : 21, "advanced" : 13, "needTime" : 7, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "backward", "docsExamined" : 19 } }, "ts" : ISODate("2021-12-21T11:41:52.331Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
Type "it" for more
> it
{ "op" : "query", "ns" : "qmulairline.system.profile", "command" : { "find" : "system.profile", "filter" : { "planSummary" : { "$eq" : "COLLSCAN" }, "op" : { "$eq" : "query" } }, "sort" : { "millis" : -1 }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 20, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 7, "queryHash" : "69B24995", "planCacheKey" : "84F9E447", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 7368, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "SORT", "nReturned" : 7, "executionTimeMillisEstimate" : 0, "works" : 30, "advanced" : 7, "needTime" : 22, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "sortPattern" : { "millis" : -1 }, "memLimit" : 104857600, "type" : "simple", "totalDataSizeSorted" : 7456, "usedDisk" : false, "inputStage" : { "stage" : "COLLSCAN", "filter" : { "$and" : [ { "op" : { "$eq" : "query" } }, { "planSummary" : { "$eq" : "COLLSCAN" } } ] }, "nReturned" : 7, "executionTimeMillisEstimate" : 0, "works" : 22, "advanced" : 7, "needTime" : 14, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 20 } }, "ts" : ISODate("2021-12-21T12:20:56.371Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.system.profile", "command" : { "find" : "system.profile", "filter" : { "op" : { "$eq" : "command" } }, "sort" : { "millis" : -1 }, "projection" : { "command.pipeline" : 1, "millis" : 1 }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 13, "queryHash" : "50815678", "planCacheKey" : "DE95405E", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 8893, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "SORT", "nReturned" : 13, "executionTimeMillisEstimate" : 0, "works" : 37, "advanced" : 13, "needTime" : 23, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "sortPattern" : { "millis" : -1 }, "memLimit" : 104857600, "type" : "simple", "totalDataSizeSorted" : 9152, "usedDisk" : false, "inputStage" : { "stage" : "PROJECTION_DEFAULT", "nReturned" : 13, "executionTimeMillisEstimate" : 0, "works" : 23, "advanced" : 13, "needTime" : 9, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "transformBy" : {  }, "inputStage" : { "stage" : "COLLSCAN", "filter" : { "op" : { "$eq" : "command" } }, "nReturned" : 13, "executionTimeMillisEstimate" : 0, "works" : 23, "advanced" : 13, "needTime" : 9, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 21 } } }, "ts" : ISODate("2021-12-21T12:21:50.608Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.system.profile", "command" : { "find" : "system.profile", "filter" : { "planSummary" : { "$eq" : "•FETCH" }, "op" : { "$eq" : "query" } }, "sort" : { "millis" : -1 }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 22, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 0, "queryHash" : "69B24995", "planCacheKey" : "84F9E447", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 115, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "SORT", "nReturned" : 0, "executionTimeMillisEstimate" : 0, "works" : 25, "advanced" : 0, "needTime" : 24, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "sortPattern" : { "millis" : -1 }, "memLimit" : 104857600, "type" : "simple", "totalDataSizeSorted" : 0, "usedDisk" : false, "inputStage" : { "stage" : "COLLSCAN", "filter" : { "$and" : [ { "op" : { "$eq" : "query" } }, { "planSummary" : { "$eq" : "•FETCH" } } ] }, "nReturned" : 0, "executionTimeMillisEstimate" : 0, "works" : 24, "advanced" : 0, "needTime" : 23, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 22 } }, "ts" : ISODate("2021-12-21T12:54:26.181Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.system.profile", "command" : { "find" : "system.profile", "filter" : { "planSummary" : { "$eq" : "FETCH" }, "op" : { "$eq" : "query" } }, "sort" : { "millis" : -1 }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 0, "queryHash" : "69B24995", "planCacheKey" : "84F9E447", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 115, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "SORT", "nReturned" : 0, "executionTimeMillisEstimate" : 0, "works" : 26, "advanced" : 0, "needTime" : 25, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "sortPattern" : { "millis" : -1 }, "memLimit" : 104857600, "type" : "simple", "totalDataSizeSorted" : 0, "usedDisk" : false, "inputStage" : { "stage" : "COLLSCAN", "filter" : { "$and" : [ { "op" : { "$eq" : "query" } }, { "planSummary" : { "$eq" : "FETCH" } } ] }, "nReturned" : 0, "executionTimeMillisEstimate" : 0, "works" : 25, "advanced" : 0, "needTime" : 24, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 23 } }, "ts" : ISODate("2021-12-21T12:54:48.153Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.system.profile", "command" : { "find" : "system.profile", "filter" : { "planSummary" : { "$eq" : "FETCH" }, "op" : { "$eq" : "query" } }, "sort" : { "millis" : -1 }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 24, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 0, "queryHash" : "69B24995", "planCacheKey" : "84F9E447", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 115, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "SORT", "nReturned" : 0, "executionTimeMillisEstimate" : 0, "works" : 27, "advanced" : 0, "needTime" : 26, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "sortPattern" : { "millis" : -1 }, "memLimit" : 104857600, "type" : "simple", "totalDataSizeSorted" : 0, "usedDisk" : false, "inputStage" : { "stage" : "COLLSCAN", "filter" : { "$and" : [ { "op" : { "$eq" : "query" } }, { "planSummary" : { "$eq" : "FETCH" } } ] }, "nReturned" : 0, "executionTimeMillisEstimate" : 0, "works" : 26, "advanced" : 0, "needTime" : 25, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 24 } }, "ts" : ISODate("2021-12-21T12:55:01.588Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.system.profile", "command" : { "find" : "system.profile", "filter" : { "planSummary" : { "$eq" : "SORT" }, "op" : { "$eq" : "query" } }, "sort" : { "millis" : -1 }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 25, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 0, "queryHash" : "69B24995", "planCacheKey" : "84F9E447", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 115, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "SORT", "nReturned" : 0, "executionTimeMillisEstimate" : 0, "works" : 28, "advanced" : 0, "needTime" : 27, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "sortPattern" : { "millis" : -1 }, "memLimit" : 104857600, "type" : "simple", "totalDataSizeSorted" : 0, "usedDisk" : false, "inputStage" : { "stage" : "COLLSCAN", "filter" : { "$and" : [ { "op" : { "$eq" : "query" } }, { "planSummary" : { "$eq" : "SORT" } } ] }, "nReturned" : 0, "executionTimeMillisEstimate" : 0, "works" : 27, "advanced" : 0, "needTime" : 26, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 25 } }, "ts" : ISODate("2021-12-21T12:55:11.657Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.system.profile", "command" : { "find" : "system.profile", "filter" : { "planSummary" : { "$eq" : "IXSCAN" }, "op" : { "$eq" : "query" } }, "sort" : { "millis" : -1 }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 26, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 0, "queryHash" : "69B24995", "planCacheKey" : "84F9E447", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 115, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "SORT", "nReturned" : 0, "executionTimeMillisEstimate" : 0, "works" : 29, "advanced" : 0, "needTime" : 28, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "sortPattern" : { "millis" : -1 }, "memLimit" : 104857600, "type" : "simple", "totalDataSizeSorted" : 0, "usedDisk" : false, "inputStage" : { "stage" : "COLLSCAN", "filter" : { "$and" : [ { "op" : { "$eq" : "query" } }, { "planSummary" : { "$eq" : "IXSCAN" } } ] }, "nReturned" : 0, "executionTimeMillisEstimate" : 0, "works" : 28, "advanced" : 0, "needTime" : 27, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 26 } }, "ts" : ISODate("2021-12-21T12:55:29.378Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.customers", "command" : { "aggregate" : "customers", "pipeline" : [ { "$project" : { "name" : { "$concat" : [ "$title", " ", "$firstName", " ", "$lastName" ] }, "customer_id" : 1 } }, { "$lookup" : { "from" : "bookings", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$project" : { "name" : "$name", "customer_id" : 1, "flight" : "$bookings.flight_id", "price" : "$bookings.bookingAmount" } }, { "$unwind" : "$flight" }, { "$lookup" : { "from" : "flightSchedule", "localField" : "flight", "foreignField" : "flight_id", "as" : "schedule" } }, { "$unwind" : "$schedule" }, { "$project" : { "_id" : 0, "name" : 1, "price" : 1, "travel" : { "$concat" : [ "$schedule.departureCity", "-", "$schedule.arrivalCity" ] }, "travelTime" : { "$concat" : [ { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.departureTime" } }, " - ", { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.arrivalTime" } } ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 897, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 29, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(118) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(118) } } }, "flowControl" : {  }, "responseLength" : 4239, "protocol" : "op_msg", "millis" : 8, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:05:00.372Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.bookings", "command" : { "aggregate" : "bookings", "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "bookingAmount" : 1 } }, { "$sort" : { "bookingAmount" : -1 } }, { "$limit" : 5 }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Top5", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] }, "address" : { "$concat" : [ { "$toString" : "$customers.address.buildingNo" }, " ", "$customers.address.street", ", ", "$customers.address.city", "-", "$customers.address.zipcode" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 123, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 5, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(12) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(12) } } }, "flowControl" : {  }, "responseLength" : 615, "protocol" : "op_msg", "millis" : 1, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:05:06.441Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.bookings", "command" : { "aggregate" : "bookings", "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : { "$cond" : { "if" : { "$isArray" : "$flight_id" }, "then" : { "$size" : "$flight_id" }, "else" : "NA" } } } }, { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : 1, "isMore" : { "$cond" : { "if" : { "$gt" : [ "$flightCount", 1 ] }, "then" : true, "else" : false } } } }, { "$group" : { "_id" : "$isMore", "customer_id" : { "$addToSet" : "$customer_id" } } }, { "$match" : { "_id" : true } }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Flights", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 8, "queryHash" : "08A9F031", "planCacheKey" : "59FC5123", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(4) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(4) } } }, "flowControl" : {  }, "responseLength" : 552, "protocol" : "op_msg", "millis" : 1, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:05:29.131Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id", "employee_list" : "$employee_list" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 17 } } ] } }, { "$unwind" : "$employee_list" }, { "$group" : { "_id" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] }, "employee" : { "$addToSet" : "$employee_list" } } }, { "$unwind" : "$employee" }, { "$lookup" : { "from" : "employees", "localField" : "employee", "foreignField" : "employee_id", "as" : "employees" } }, { "$unwind" : "$employees" }, { "$project" : { "_id" : "$_id", "Name" : { "$concat" : [ "$employees.firstName", " ", "$employees.lastName" ] }, "Number" : "$employees.contactNumber" } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 241, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 12, "queryHash" : "5361BE73", "planCacheKey" : "59FBB228", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(26) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(26) } } }, "flowControl" : {  }, "responseLength" : 935, "protocol" : "op_msg", "millis" : 3, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:14.410Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.bookings", "command" : { "aggregate" : "bookings", "pipeline" : [ { "$group" : { "_id" : "$bookingDate", "customerPayment" : { "$sum" : "$bookingAmount" } } }, { "$lookup" : { "from" : "employees", "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } } ], "as" : "employees" } }, { "$unwind" : "$employees" }, { "$group" : { "_id" : "$customerPayment", "totalSalary" : { "$sum" : { "$sum" : "$employees.employeeWorkSchedule.salary" } } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$totalSalary" ] } } }, { "$lookup" : { "from" : "planes", "pipeline" : [ { "$match" : { "state.status" : { "$in" : [ "in-repair", "upgraded" ] } } } ], "as" : "maintainanceCost" } }, { "$unwind" : "$maintainanceCost" }, { "$group" : { "_id" : "$profitEarned", "maintainanceCost" : { "$sum" : "$maintainanceCost.state.repairCost" } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$maintainanceCost" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 48, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 1, "queryHash" : "685D33D1", "planCacheKey" : "FC552456", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(6) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(6) } } }, "flowControl" : {  }, "responseLength" : 155, "protocol" : "op_msg", "millis" : 1, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:23.157Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 16 } } ] } }, { "$group" : { "_id" : { "date" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] } }, "flights" : { "$push" : "$flight" } } }, { "$unwind" : "$flights" }, { "$lookup" : { "from" : "bookings", "localField" : "flights", "foreignField" : "flight_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$group" : { "_id" : "$bookings.customer_id" } }, { "$lookup" : { "from" : "customers", "localField" : "_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "$_id", "customer" : { "$concat" : [ "$customers.title", " ", "$customers.firstName", " ", "$customers.lastName" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 400, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 12, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(36) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(36) } } }, "flowControl" : {  }, "responseLength" : 817, "protocol" : "op_msg", "millis" : 1, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:29.732Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "joiningDate" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "joiningDate" : 1 } }, { "$sort" : { "joiningDate" : 1 } }, { "$limit" : 5 } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 5, "queryHash" : "20758362", "planCacheKey" : "1F03DCD3", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 469, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:34.652Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "address" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "address" : 1 } }, { "$group" : { "_id" : "$address.city", "employeeList" : { "$push" : "$name" } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 4, "queryHash" : "57ECD407", "planCacheKey" : "3FCB7D05", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 742, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:42.186Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "employeeWorkSchedule" : 1 } }, { "$unwind" : "$employeeWorkSchedule" }, { "$group" : { "_id" : "$name", "salary" : { "$sum" : "$employeeWorkSchedule.salary" } } }, { "$sort" : { "salary" : -1 } }, { "$limit" : 5 } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 5, "queryHash" : "3B6B892B", "planCacheKey" : "5EBAD363", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 345, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:49.946Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "departureCity" : "$departureCity", "arrivalCity" : "$arrivalCity" } }, { "$group" : { "_id" : { "year" : "$year", "month" : "$month", "dayOfMonth" : "$dayOfMonth" }, "flights" : { "$push" : { "$concat" : [ "$departureCity", " - ", "$arrivalCity" ] } } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 10, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 2, "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 529, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:55.126Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.bookings", "command" : { "find" : "bookings", "filter" : { "$where" : "this.flight_id.length > 1" }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 8, "queryHash" : "864B2828", "planCacheKey" : "FA885FE8", "locks" : { "ReplicationStateTransition" : { "acquireCount" : { "w" : NumberLong(1) } }, "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "storage" : {  }, "responseLength" : 1543, "protocol" : "op_msg", "millis" : 36, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "COLLSCAN", "filter" : { "$where" : { "code" : "this.flight_id.length > 1" } }, "nReturned" : 8, "executionTimeMillisEstimate" : 5, "works" : 25, "advanced" : 8, "needTime" : 16, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "forward", "docsExamined" : 23 }, "ts" : ISODate("2021-12-21T13:06:59.668Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "lastWorkingDate" : { "$exists" : false } } }, { "$project" : { "_id" : 0, "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "number" : "$contactNumber", "address" : { "$concat" : [ { "$toString" : "$address.buildingNo" }, " ", "$address.street", ", ", "$address.city", "-", "$address.zipcode" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 16, "queryHash" : "B759E49D", "planCacheKey" : "57356B65", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 1622, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:07:06.226Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "query", "ns" : "qmulairline.system.profile", "command" : { "find" : "system.profile", "filter" : { "command.pipeline" : { "$exists" : true } }, "sort" : { "$natural" : -1 }, "projection" : { "command.pipeline" : 1 }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 39, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 24, "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 15945, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "execStats" : { "stage" : "PROJECTION_DEFAULT", "nReturned" : 24, "executionTimeMillisEstimate" : 0, "works" : 41, "advanced" : 24, "needTime" : 16, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "transformBy" : {  }, "inputStage" : { "stage" : "COLLSCAN", "filter" : { "command.pipeline" : { "$exists" : true } }, "nReturned" : 24, "executionTimeMillisEstimate" : 0, "works" : 41, "advanced" : 24, "needTime" : 16, "needYield" : 0, "saveState" : 0, "restoreState" : 0, "isEOF" : 1, "direction" : "backward", "docsExamined" : 39 } }, "ts" : ISODate("2021-12-21T13:07:24.825Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
Type "it" for more
>


// 6. The query showed all the command being executed with the plan summary COLLSCAN. As the profiling paramter were minimised and set to "slowms:10", data were captured for query execution below 1s
// After executing the 12 sets of query most of the execution status were captured. The query showed more result.

> db.system.profile.find({"planSummary":{$eq:"COLLSCAN"},"op" : {$eq:"command"}}).sort({millis:-1},{$limit:10})
{ "op" : "command", "ns" : "qmulairline.customers", "command" : { "aggregate" : "customers", "pipeline" : [ { "$project" : { "name" : { "$concat" : [ "$title", " ", "$firstName", " ", "$lastName" ] }, "customer_id" : 1 } }, { "$lookup" : { "from" : "bookings", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$project" : { "name" : "$name", "customer_id" : 1, "flight" : "$bookings.flight_id", "price" : "$bookings.bookingAmount" } }, { "$unwind" : "$flight" }, { "$lookup" : { "from" : "flightSchedule", "localField" : "flight", "foreignField" : "flight_id", "as" : "schedule" } }, { "$unwind" : "$schedule" }, { "$project" : { "_id" : 0, "name" : 1, "price" : 1, "travel" : { "$concat" : [ "$schedule.departureCity", "-", "$schedule.arrivalCity" ] }, "travelTime" : { "$concat" : [ { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.departureTime" } }, " - ", { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.arrivalTime" } } ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 897, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 29, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(118) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(118) } } }, "flowControl" : {  }, "responseLength" : 4239, "protocol" : "op_msg", "millis" : 8, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:05:00.372Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.customers", "command" : { "aggregate" : "customers", "pipeline" : [ { "$project" : { "name" : { "$concat" : [ "$title", " ", "$firstName", " ", "$lastName" ] }, "customer_id" : 1 } }, { "$lookup" : { "from" : "bookings", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$project" : { "name" : "$name", "customer_id" : 1, "flight" : "$bookings.flight_id", "price" : "$bookings.bookingAmount" } }, { "$unwind" : "$flight" }, { "$lookup" : { "from" : "flightSchedule", "localField" : "flight", "foreignField" : "flight_id", "as" : "schedule" } }, { "$unwind" : "$schedule" }, { "$project" : { "_id" : 0, "name" : 1, "price" : 1, "travel" : { "$concat" : [ "$schedule.departureCity", "-", "$schedule.arrivalCity" ] }, "departureTime" : { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.departureTime" } }, "arrivalTime" : { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.arrivalTime" } } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 897, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 29, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(118) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(118) } } }, "flowControl" : {  }, "responseLength" : 4761, "protocol" : "op_msg", "millis" : 3, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T10:04:48.347Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 16 } } ] } }, { "$group" : { "_id" : { "date" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] } }, "flights" : { "$push" : "$flight" } } }, { "$unwind" : "$flights" }, { "$lookup" : { "from" : "bookings", "localField" : "flights", "foreignField" : "flight_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$group" : { "_id" : "$bookings.customer_id" } }, { "$lookup" : { "from" : "customers", "localField" : "_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "$_id", "customer" : { "$concat" : [ "$customers.title", " ", "$customers.firstName", " ", "$customers.lastName" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 400, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 12, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(36) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(36) } } }, "flowControl" : {  }, "responseLength" : 817, "protocol" : "op_msg", "millis" : 3, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:45.970Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.customers", "command" : { "aggregate" : "customers", "pipeline" : [ { "$project" : { "name" : { "$concat" : [ "$title", " ", "$firstName", " ", "$lastName" ] }, "customer_id" : 1 } }, { "$lookup" : { "from" : "bookings", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$project" : { "name" : "$name", "customer_id" : 1, "flight" : "$bookings.flight_id", "price" : "$bookings.bookingAmount" } }, { "$unwind" : "$flight" }, { "$lookup" : { "from" : "flightSchedule", "localField" : "flight", "foreignField" : "flight_id", "as" : "schedule" } }, { "$unwind" : "$schedule" }, { "$project" : { "_id" : 0, "name" : 1, "price" : 1, "travel" : { "$concat" : [ "$schedule.departureCity", "-", "$schedule.arrivalCity" ] }, "travelTime" : { "$concat" : [ { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.departureTime" } }, " - ", { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.arrivalTime" } } ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 897, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 29, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(118) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(118) } } }, "flowControl" : {  }, "responseLength" : 4239, "protocol" : "op_msg", "millis" : 3, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:41:15.262Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id", "employee_list" : "$employee_list" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 17 } } ] } }, { "$unwind" : "$employee_list" }, { "$group" : { "_id" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] }, "employee" : { "$addToSet" : "$employee_list" } } }, { "$unwind" : "$employee" }, { "$lookup" : { "from" : "employees", "localField" : "employee", "foreignField" : "employee_id", "as" : "employees" } }, { "$unwind" : "$employees" }, { "$project" : { "_id" : "$_id", "Name" : { "$concat" : [ "$employees.firstName", " ", "$employees.lastName" ] }, "Number" : "$employees.contactNumber" } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 241, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 12, "queryHash" : "5361BE73", "planCacheKey" : "59FBB228", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(26) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(26) } } }, "flowControl" : {  }, "responseLength" : 935, "protocol" : "op_msg", "millis" : 3, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:14.410Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "lastWorkingDate" : { "$exists" : false } } }, { "$project" : { "_id" : 0, "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "number" : "$contactNumber", "address" : { "$concat" : [ { "$toString" : "$address.buildingNo" }, " ", "$address.street", ", ", "$address.city", "-", "$address.zipcode" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 16, "queryHash" : "B759E49D", "planCacheKey" : "57356B65", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 1622, "protocol" : "op_msg", "millis" : 2, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:05.123Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "departureCity" : "$departureCity", "arrivalCity" : "$arrivalCity" } }, { "$group" : { "_id" : { "year" : "$year", "month" : "$month", "dayOfMonth" : "$dayOfMonth" }, "flights" : { "$push" : { "$concat" : [ "$departureCity", " - ", "$arrivalCity" ] } } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 10, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 2, "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 529, "protocol" : "op_msg", "millis" : 2, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:16.085Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id", "employee_list" : "$employee_list" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 17 } } ] } }, { "$unwind" : "$employee_list" }, { "$group" : { "_id" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] }, "employee" : { "$addToSet" : "$employee_list" } } }, { "$unwind" : "$employee" }, { "$lookup" : { "from" : "employees", "localField" : "employee", "foreignField" : "employee_id", "as" : "employees" } }, { "$unwind" : "$employees" }, { "$project" : { "_id" : "$_id", "Name" : { "$concat" : [ "$employees.firstName", " ", "$employees.lastName" ] }, "Number" : "$employees.contactNumber" } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 241, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 12, "queryHash" : "5361BE73", "planCacheKey" : "59FBB228", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(26) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(26) } } }, "flowControl" : {  }, "responseLength" : 935, "protocol" : "op_msg", "millis" : 2, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:57.483Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.bookings", "command" : { "aggregate" : "bookings", "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "bookingAmount" : 1 } }, { "$sort" : { "bookingAmount" : -1 } }, { "$limit" : 5 }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Top5", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] }, "address" : { "$concat" : [ { "$toString" : "$customers.address.buildingNo" }, " ", "$customers.address.street", ", ", "$customers.address.city", "-", "$customers.address.zipcode" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 123, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 5, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(12) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(12) } } }, "flowControl" : {  }, "responseLength" : 615, "protocol" : "op_msg", "millis" : 1, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:41:09.405Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.bookings", "command" : { "aggregate" : "bookings", "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "bookingAmount" : 1 } }, { "$sort" : { "bookingAmount" : -1 } }, { "$limit" : 5 }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Top5", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] }, "address" : { "$concat" : [ { "$toString" : "$customers.address.buildingNo" }, " ", "$customers.address.street", ", ", "$customers.address.city", "-", "$customers.address.zipcode" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 123, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 5, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(12) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(12) } } }, "flowControl" : {  }, "responseLength" : 615, "protocol" : "op_msg", "millis" : 1, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:05:06.441Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.bookings", "command" : { "aggregate" : "bookings", "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : { "$cond" : { "if" : { "$isArray" : "$flight_id" }, "then" : { "$size" : "$flight_id" }, "else" : "NA" } } } }, { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : 1, "isMore" : { "$cond" : { "if" : { "$gt" : [ "$flightCount", 1 ] }, "then" : true, "else" : false } } } }, { "$group" : { "_id" : "$isMore", "customer_id" : { "$addToSet" : "$customer_id" } } }, { "$match" : { "_id" : true } }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Flights", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 8, "queryHash" : "08A9F031", "planCacheKey" : "59FC5123", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(4) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(4) } } }, "flowControl" : {  }, "responseLength" : 552, "protocol" : "op_msg", "millis" : 1, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:05:29.131Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.bookings", "command" : { "aggregate" : "bookings", "pipeline" : [ { "$group" : { "_id" : "$bookingDate", "customerPayment" : { "$sum" : "$bookingAmount" } } }, { "$lookup" : { "from" : "employees", "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } } ], "as" : "employees" } }, { "$unwind" : "$employees" }, { "$group" : { "_id" : "$customerPayment", "totalSalary" : { "$sum" : { "$sum" : "$employees.employeeWorkSchedule.salary" } } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$totalSalary" ] } } }, { "$lookup" : { "from" : "planes", "pipeline" : [ { "$match" : { "state.status" : { "$in" : [ "in-repair", "upgraded" ] } } } ], "as" : "maintainanceCost" } }, { "$unwind" : "$maintainanceCost" }, { "$group" : { "_id" : "$profitEarned", "maintainanceCost" : { "$sum" : "$maintainanceCost.state.repairCost" } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$maintainanceCost" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 48, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 1, "queryHash" : "685D33D1", "planCacheKey" : "FC552456", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(6) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(6) } } }, "flowControl" : {  }, "responseLength" : 155, "protocol" : "op_msg", "millis" : 1, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:23.157Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 16 } } ] } }, { "$group" : { "_id" : { "date" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] } }, "flights" : { "$push" : "$flight" } } }, { "$unwind" : "$flights" }, { "$lookup" : { "from" : "bookings", "localField" : "flights", "foreignField" : "flight_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$group" : { "_id" : "$bookings.customer_id" } }, { "$lookup" : { "from" : "customers", "localField" : "_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "$_id", "customer" : { "$concat" : [ "$customers.title", " ", "$customers.firstName", " ", "$customers.lastName" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 400, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 12, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(36) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(36) } } }, "flowControl" : {  }, "responseLength" : 817, "protocol" : "op_msg", "millis" : 1, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:29.732Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "departureCity" : "$departureCity", "arrivalCity" : "$arrivalCity" } }, { "$group" : { "_id" : { "year" : "$year", "month" : "$month", "dayOfMonth" : "$dayOfMonth" }, "flights" : { "$push" : { "$concat" : [ "$departureCity", " - ", "$arrivalCity" ] } } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 10, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 2, "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 529, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T10:04:58.214Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "employeeWorkSchedule" : 1 } }, { "$unwind" : "$employeeWorkSchedule" }, { "$group" : { "_id" : "$name", "salary" : { "$sum" : "$employeeWorkSchedule.salary" } } }, { "$sort" : { "salary" : -1 } }, { "$limit" : 5 } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 5, "queryHash" : "3B6B892B", "planCacheKey" : "5EBAD363", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 345, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:27.316Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "address" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "address" : 1 } }, { "$group" : { "_id" : "$address.city", "employeeList" : { "$push" : "$name" } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 4, "queryHash" : "57ECD407", "planCacheKey" : "3FCB7D05", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 742, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:33.725Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "joiningDate" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "joiningDate" : 1 } }, { "$sort" : { "joiningDate" : 1 } }, { "$limit" : 5 } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 5, "queryHash" : "20758362", "planCacheKey" : "1F03DCD3", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 469, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:39.386Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.bookings", "command" : { "aggregate" : "bookings", "pipeline" : [ { "$group" : { "_id" : "$bookingDate", "customerPayment" : { "$sum" : "$bookingAmount" } } }, { "$lookup" : { "from" : "employees", "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } } ], "as" : "employees" } }, { "$unwind" : "$employees" }, { "$group" : { "_id" : "$customerPayment", "totalSalary" : { "$sum" : { "$sum" : "$employees.employeeWorkSchedule.salary" } } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$totalSalary" ] } } }, { "$lookup" : { "from" : "planes", "pipeline" : [ { "$match" : { "state.status" : { "$in" : [ "in-repair", "upgraded" ] } } } ], "as" : "maintainanceCost" } }, { "$unwind" : "$maintainanceCost" }, { "$group" : { "_id" : "$profitEarned", "maintainanceCost" : { "$sum" : "$maintainanceCost.state.repairCost" } } }, { "$project" : { "_id" : "Profit", "profitEarned" : { "$subtract" : [ "$_id", "$maintainanceCost" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 48, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 1, "queryHash" : "685D33D1", "planCacheKey" : "FC552456", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(6) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(6) } } }, "flowControl" : {  }, "responseLength" : 155, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:52.079Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.bookings", "command" : { "aggregate" : "bookings", "pipeline" : [ { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : { "$cond" : { "if" : { "$isArray" : "$flight_id" }, "then" : { "$size" : "$flight_id" }, "else" : "NA" } } } }, { "$project" : { "book_id" : 1, "customer_id" : 1, "flightCount" : 1, "isMore" : { "$cond" : { "if" : { "$gt" : [ "$flightCount", 1 ] }, "then" : true, "else" : false } } } }, { "$group" : { "_id" : "$isMore", "customer_id" : { "$addToSet" : "$customer_id" } } }, { "$match" : { "_id" : true } }, { "$lookup" : { "from" : "customers", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "Flights", "customer" : { "$concat" : [ "$customers.firstName", " ", "$customers.lastName" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 23, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 8, "queryHash" : "08A9F031", "planCacheKey" : "59FC5123", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(4) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(4) } } }, "flowControl" : {  }, "responseLength" : 552, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:41:04.036Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "joiningDate" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "joiningDate" : 1 } }, { "$sort" : { "joiningDate" : 1 } }, { "$limit" : 5 } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 5, "queryHash" : "20758362", "planCacheKey" : "1F03DCD3", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 469, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:34.652Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
Type "it" for more
>> it
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "address" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "address" : 1 } }, { "$group" : { "_id" : "$address.city", "employeeList" : { "$push" : "$name" } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 4, "queryHash" : "57ECD407", "planCacheKey" : "3FCB7D05", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 742, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:42.186Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "employeeWorkSchedule" : { "$exists" : true } } }, { "$project" : { "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "employeeWorkSchedule" : 1 } }, { "$unwind" : "$employeeWorkSchedule" }, { "$group" : { "_id" : "$name", "salary" : { "$sum" : "$employeeWorkSchedule.salary" } } }, { "$sort" : { "salary" : -1 } }, { "$limit" : 5 } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "hasSortStage" : true, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 5, "queryHash" : "3B6B892B", "planCacheKey" : "5EBAD363", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 345, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:49.946Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "departureCity" : "$departureCity", "arrivalCity" : "$arrivalCity" } }, { "$group" : { "_id" : { "year" : "$year", "month" : "$month", "dayOfMonth" : "$dayOfMonth" }, "flights" : { "$push" : { "$concat" : [ "$departureCity", " - ", "$arrivalCity" ] } } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 10, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 2, "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(2) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(2) } } }, "flowControl" : {  }, "responseLength" : 529, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:06:55.126Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
{ "op" : "command", "ns" : "qmulairline.employees", "command" : { "aggregate" : "employees", "pipeline" : [ { "$match" : { "lastWorkingDate" : { "$exists" : false } } }, { "$project" : { "_id" : 0, "name" : { "$concat" : [ "$firstName", " ", "$lastName" ] }, "number" : "$contactNumber", "address" : { "$concat" : [ { "$toString" : "$address.buildingNo" }, " ", "$address.street", ", ", "$address.city", "-", "$address.zipcode" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 21, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 16, "queryHash" : "B759E49D", "planCacheKey" : "57356B65", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(1) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(1) } } }, "flowControl" : {  }, "responseLength" : 1622, "protocol" : "op_msg", "millis" : 0, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T13:07:06.226Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }


// 7. After changing the profiling level a total of 54 execution were capture in the system.profile. out of which 24 queries/command used COLLSCAN  
> db.system.profile.find().count();
54
> db.system.profile.find({"planSummary":{$eq:"COLLSCAN"},"op" : {$eq:"query"}}).count();
28


Profiler Explanation:

Query 7: Customers who travlled on 16:
{ "op" : "command", "ns" : "qmulairline.flightSchedule", "command" : { "aggregate" : "flightSchedule", "pipeline" : [ { "$project" : { "year" : { "$year" : "$departureTime" }, "month" : { "$month" : "$departureTime" }, "dayOfMonth" : { "$dayOfMonth" : "$departureTime" }, "flight" : "$flight_id" } }, { "$match" : { "$and" : [ { "year" : { "$eq" : 2021 } }, { "month" : { "$eq" : 11 } }, { "dayOfMonth" : { "$eq" : 16 } } ] } }, { "$group" : { "_id" : { "date" : { "$concat" : [ { "$toString" : "$year" }, "-", { "$toString" : "$month" }, "-", { "$toString" : "$dayOfMonth" } ] } }, "flights" : { "$push" : "$flight" } } }, { "$unwind" : "$flights" }, { "$lookup" : { "from" : "bookings", "localField" : "flights", "foreignField" : "flight_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$group" : { "_id" : "$bookings.customer_id" } }, { "$lookup" : { "from" : "customers", "localField" : "_id", "foreignField" : "customer_id", "as" : "customers" } }, { "$unwind" : "$customers" }, { "$project" : { "_id" : "$_id", "customer" : { "$concat" : [ "$customers.title", " ", "$customers.firstName", " ", "$customers.lastName" ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 400, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 12, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(36) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(36) } } }, "flowControl" : {  }, "responseLength" : 817, "protocol" : "op_msg", "millis" : 3, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:40:45.970Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }
Query 12: Travel history of each passenger with date, fligh and price
{ "op" : "command", "ns" : "qmulairline.customers", "command" : { "aggregate" : "customers", "pipeline" : [ { "$project" : { "name" : { "$concat" : [ "$title", " ", "$firstName", " ", "$lastName" ] }, "customer_id" : 1 } }, { "$lookup" : { "from" : "bookings", "localField" : "customer_id", "foreignField" : "customer_id", "as" : "bookings" } }, { "$unwind" : "$bookings" }, { "$project" : { "name" : "$name", "customer_id" : 1, "flight" : "$bookings.flight_id", "price" : "$bookings.bookingAmount" } }, { "$unwind" : "$flight" }, { "$lookup" : { "from" : "flightSchedule", "localField" : "flight", "foreignField" : "flight_id", "as" : "schedule" } }, { "$unwind" : "$schedule" }, { "$project" : { "_id" : 0, "name" : 1, "price" : 1, "travel" : { "$concat" : [ "$schedule.departureCity", "-", "$schedule.arrivalCity" ] }, "travelTime" : { "$concat" : [ { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.departureTime" } }, " - ", { "$dateToString" : { "format" : "%Y:%m:%d-%H:%M:%S", "date" : "$schedule.arrivalTime" } } ] } } } ], "cursor" : {  }, "lsid" : { "id" : UUID("397aaf8a-5214-4e7c-86c5-c58e2d452d79") }, "$db" : "qmulairline" }, "keysExamined" : 0, "docsExamined" : 897, "cursorExhausted" : true, "numYield" : 0, "nreturned" : 29, "queryHash" : "F2460F4B", "planCacheKey" : "21280CBD", "locks" : { "Global" : { "acquireCount" : { "r" : NumberLong(118) } }, "Mutex" : { "acquireCount" : { "r" : NumberLong(118) } } }, "flowControl" : {  }, "responseLength" : 4239, "protocol" : "op_msg", "millis" : 3, "planSummary" : "COLLSCAN", "ts" : ISODate("2021-12-21T11:41:15.262Z"), "client" : "127.0.0.1", "appName" : "MongoDB Shell", "allUsers" : [ ], "user" : "" }

For each of the command executed the profiler saves the following important details:
1. command.pipeline: describes each and every aggregate utility being used such as $match, $group, $unwind, $lookup etc..
2. "docsExamined": 400: stores the deatils of the documents that are examined during the execution.
3. "nreturned": 12: infers that the execution of the pipeline returned 12 documents.
4. "millis": 3 : execution time.
5. system profle deatils like "ts": ISODate("2021-12-21T11:40:45.970Z"), "client": "127.0.0.1", "appName": "MongoDB Shell".
